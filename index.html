<!DOCTYPE html>
<html lang="es">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width,initial-scale=1" />
Â  <title>Pedidos ML | Dashboard</title>
Â  <meta name="theme-color" content="#0d6efd" />
Â  <link rel="manifest" href="manifest.webmanifest" />

Â  <style>
Â  Â  /* Paleta de colores base para un diseÃ±o sofisticado */
Â  Â  :root{
Â  Â  Â  --primary:#0d6efd; /* Cambia con el selector de tema */
Â  Â  Â  --bg:#f7f9fc; /* Fondo suave */
Â  Â  Â  --text:#1a202c; /* Texto oscuro y nÃ­tido */
Â  Â  Â  --card:#ffffff; /* Tarjetas blancas */
Â  Â  Â  --muted:#718096; /* Texto secundario elegante */
Â  Â  Â  --success:#10b981; /* Verde esmeralda */
Â  Â  Â  --warn:#f59e0b; /* Amarillo Ã¡mbar */
Â  Â  Â  --error:#ef4444;
Â  Â  Â  --ok:#10b981;
Â  Â  Â  --shadow:0 8px 25px rgba(0,0,0,0.08); /* Sombra elegante */
Â  Â  Â  --radius-large: 18px;
Â  Â  Â  --radius-medium: 12px;
Â  Â  }

Â  Â  /* Modo Oscuro Fino */
Â  Â  @media (prefers-color-scheme: dark){
Â  Â  Â  :root{
Â  Â  Â  Â  --bg:#0f172a; /* Azul oscuro noche */
Â  Â  Â  Â  --text:#e2e8f0;
Â  Â  Â  Â  --card:#1e293b; /* Tarjetas mÃ¡s oscuras */
Â  Â  Â  Â  --muted:#94a3b8;
Â  Â  Â  Â  --shadow:0 10px 30px rgba(0,0,0,0.6);
Â  Â  Â  }
Â  Â  }

Â  Â  html,body{height:100%}
Â  Â  body{
Â  Â  Â  font-family:'Inter', 'Segoe UI',Roboto,Arial,sans-serif; /* Fuente moderna */
Â  Â  Â  margin:0; padding:0;
Â  Â  Â  background:var(--bg); color:var(--text);
Â  Â  Â  overflow-x:hidden;
Â  Â  Â  transition:background 0.3s, color 0.3s;
Â  Â  }

Â  Â  header{
Â  Â  Â  position:sticky; top:0; z-index:1000;
Â  Â  Â  display:flex; align-items:center; justify-content:space-between; /* Ajuste para contador */
Â  Â  Â  background:var(--primary); color:#fff;
Â  Â  Â  padding:14px 18px;
Â  Â  Â  font-size:22px; font-weight:800; /* MÃ¡s audaz */
Â  Â  Â  box-shadow:0 4px 12px rgba(0,0,0,0.25);
Â  Â  }
Â  Â  #connDot{
Â  Â  Â  /* Mantenemos el punto, pero lo reposicionamos en el header */
Â  Â  Â  position:relative; margin-left:10px;
Â  Â  Â  width:12px; height:12px; border-radius:50%;
Â  Â  Â  box-shadow:0 0 0 3px rgba(255,255,255,0.25);
Â  Â  }
Â  Â  .online{ background:var(--success); }
Â  Â  .offline{ background:var(--error); }
Â  Â  .syncing{ animation:pulse 0.8s ease-in-out infinite alternate; background:var(--success);}

Â  Â  #dailyCounter{
Â  Â  Â  font-size:16px; font-weight:600; padding:4px 8px;
Â  Â  Â  border-radius:var(--radius-medium); background:rgba(255,255,255,0.2);
Â  Â  }

Â  Â  #netBanner{
Â  Â  Â  display:none; text-align:center;
Â  Â  Â  background:var(--warn); color:var(--text);
Â  Â  Â  padding:10px; font-weight:700; font-size:15px;
Â  Â  Â  transition:all 0.3s ease;
Â  Â  }

Â  Â  main{ padding:20px; max-width:860px; margin:0 auto; }

Â  Â  label{ display:block; font-size:15px; font-weight:600; color:var(--muted); margin-bottom:8px; }
Â  Â  .row{ margin-bottom:20px; }
Â  Â  /* Entradas grandes y tÃ¡ctiles */
Â  Â  input,textarea,select{
Â  Â  Â  width:100%; box-sizing:border-box;
Â  Â  Â  font-size:18px; /* Texto mÃ¡s grande */
Â  Â  Â  padding:16px 16px; /* Padding para dedos gordos */
Â  Â  Â  border-radius:var(--radius-large); /* Bordes redondeados modernos */
Â  Â  Â  border:2px solid var(--muted); /* Borde sutil */
Â  Â  Â  background:var(--card); color:var(--text);
Â  Â  Â  outline:none;
Â  Â  Â  transition:border-color 0.2s, box-shadow 0.2s;
Â  Â  }
Â  Â  input:focus, textarea:focus {
Â  Â  Â  border-color: var(--primary);
Â  Â  Â  box-shadow: 0 0 0 4px color-mix(in srgb, var(--primary) 20%, transparent);
Â  Â  }
Â  Â  textarea{ min-height:150px; resize:vertical; }

Â  Â  .field-ok{ border-color:var(--ok)!important; }
Â  Â  .checkmark{
Â  Â  Â  font-size:20px; margin-left:8px; vertical-align:middle; color:var(--ok);
Â  Â  Â  display:inline-block;
Â  Â  Â  animation:checkPulse 0.4s ease-out; /* AnimaciÃ³n al aparecer */
Â  Â  }
Â  Â  .show-check .checkmark{ display:inline-block; }
Â  Â  @keyframes checkPulse{ from{ transform:scale(0); opacity:0.5; } to{ transform:scale(1); opacity:1; } }

Â  Â  .toolbar{
Â  Â  Â  display:flex; gap:12px; margin:16px 0 24px 0; flex-wrap:wrap;
Â  Â  Â  align-items:center;
Â  Â  }
Â  Â  /* Botones grandes y tÃ¡ctiles */
Â  Â  .btn, .btn-secondary{
Â  Â  Â  flex:1; min-width:180px;
Â  Â  Â  border:none; border-radius:var(--radius-large);
Â  Â  Â  padding:18px; font-size:18px; font-weight:700; cursor:pointer;
Â  Â  Â  box-shadow:var(--shadow);
Â  Â  Â  transition:transform .1s ease, filter .15s ease, background .2s ease;
Â  Â  Â  touch-action:manipulation; -webkit-tap-highlight-color:transparent;
Â  Â  }
Â  Â  .btn{ background:var(--primary); color:#fff; }
Â  Â  .btn:active{ transform:scale(0.97); filter:brightness(0.9); }
Â  Â  .btn[disabled]{ opacity:.5; cursor:not-allowed; filter:grayscale(.5); }

Â  Â  .btn-secondary{ background:color-mix(in srgb, var(--primary) 10%, var(--card)); color:var(--primary); box-shadow:none; }
Â  Â  .btn-secondary:active{ transform:scale(0.97); filter:brightness(0.9); }
Â  Â  @media (prefers-color-scheme: dark){ .btn-secondary{ background:color-mix(in srgb, var(--primary) 20%, var(--card)); color:var(--primary); } }

Â  Â  .bottom-nav{
Â  Â  Â  position:fixed; left:0; right:0; bottom:0; z-index:999;
Â  Â  Â  background:var(--card); border-top:1px solid var(--muted);
Â  Â  Â  display:flex; gap:10px; padding:12px 10px; box-shadow:0 -4px 15px rgba(0,0,0,0.1);
Â  Â  }
Â  Â  .bottom-nav button{ flex:1; border-radius:var(--radius-medium); padding:14px; font-weight:700; border:none; font-size:16px; }
Â  Â  .tab-btn{ background:color-mix(in srgb, var(--primary) 10%, var(--card)); color:var(--primary); transition:all 0.2s; }
Â  Â  .tab-btn.active{ background:var(--primary); color:#fff; }
Â  Â  @media (prefers-color-scheme: dark){ .tab-btn{ background:color-mix(in srgb, var(--primary) 20%, var(--card)); color:var(--primary); } }

Â  Â  .pedido-card{
Â  Â  Â  background:var(--card); border-radius:var(--radius-large); padding:18px; margin-bottom:15px;
Â  Â  Â  box-shadow:var(--shadow);
Â  Â  Â  border-left: 5px solid var(--error); /* Resaltar pendiente */
Â  Â  Â  transition:border-color 0.2s;
Â  Â  }
Â  Â  .pedido-card b { font-weight: 700; color: var(--text); }

Â  Â  /* Toast sofisticado */
Â  Â  .toast{
Â  Â  Â  position:fixed; left:50%; bottom:90px; transform:translateX(-50%) translateY(20px);
Â  Â  Â  padding:14px 20px; border-radius:var(--radius-large);
Â  Â  Â  font-size:16px; display:none; font-weight:600;
Â  Â  Â  box-shadow:0 6px 15px rgba(0,0,0,0.25);
Â  Â  Â  z-index:1001;
Â  Â  Â  opacity: 0;
Â  Â  Â  transition: opacity 0.3s ease, transform 0.3s ease;
Â  Â  }
Â  Â  .toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

Â  Â  /* Overlay Ã©xito - MÃ¡s visual y dramÃ¡tico */
Â  Â  #confirmOverlay{
Â  Â  Â  display:none; position:fixed; inset:0; z-index:1002;
Â  Â  Â  background:rgba(0,0,0,0.7); backdrop-filter:blur(3px);
Â  Â  Â  align-items:center; justify-content:center;
Â  Â  }
Â  Â  .success-box{
Â  Â  Â  background:var(--card); /* Fondo elegante, no gradiente */
Â  Â  Â  color:var(--text); border-radius:var(--radius-large); padding:40px 30px; text-align:center;
Â  Â  Â  width:min(90vw,420px); box-shadow:var(--shadow);
Â  Â  Â  animation:popIn .4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
Â  Â  }
Â  Â  .success-icon{
Â  Â  Â  font-size:90px; display:inline-block; color:var(--success);
Â  Â  Â  animation:scaleIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;
Â  Â  Â  transform-origin:center center;
Â  Â  }
Â  Â  @keyframes scaleIn{ from{ transform:scale(0.2); opacity:0.5 } to{ transform:scale(1); opacity:1 } }
Â  Â  @keyframes popIn{ from{ transform:translateY(20px); opacity:0; } to{ transform:translateY(0); opacity:1; } }


Â  Â  /* Nuevo: Overlay de Carga/Spinner */
Â  Â  #loadingOverlay{
Â  Â  Â  display:none; position:fixed; inset:0; z-index:1003;
Â  Â  Â  background:rgba(0,0,0,0.2); backdrop-filter:blur(1px);
Â  Â  Â  align-items:center; justify-content:center;
Â  Â  }
Â  Â  .spinner {
Â  Â  Â  border: 5px solid var(--primary);
Â  Â  Â  border-top: 5px solid var(--primary);
Â  Â  Â  border-right: 5px solid var(--primary);
Â  Â  Â  border-bottom: 5px solid color-mix(in srgb, var(--primary) 30%, transparent); /* Color sutil */
Â  Â  Â  border-radius: 50%;
Â  Â  Â  width: 50px;
Â  Â  Â  height: 50px;
Â  Â  Â  animation: spin 0.8s linear infinite;
Â  Â  Â  box-shadow: 0 0 10px rgba(0,0,0,0.1);
Â  Â  }
Â  Â  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }


Â  Â  /* Stats 2.7 */
Â  Â  .stats-grid{
Â  Â  Â  display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-top:12px;
Â  Â  }
Â  Â  .stat-card{ background:var(--card); border-radius:var(--radius-large); padding:20px 16px; text-align:center; box-shadow:var(--shadow); }
Â  Â  .stat-title{ font-size:14px; color:var(--muted); margin-bottom:8px; font-weight:600; }
Â  Â  .stat-value{ font-size:28px; font-weight:900; }
Â  Â  .bar{
Â  Â  Â  margin-top:10px; height:10px; border-radius:999px; background:var(--muted); overflow:hidden; opacity:0.3;
Â  Â  }
Â  Â  .bar>.fill{ height:100%; width:0%; background:var(--primary); transition:width .35s ease; }

Â  Â  /* Selector de tema 2.8 */
Â  Â  .theme-row{ display:flex; align-items:center; gap:12px; margin:6px 0 20px 0; flex-wrap:wrap; }
Â  Â  .swatch{
Â  Â  Â  width:34px; height:34px; border-radius:50%; border:3px solid var(--card); /* Borde mÃ¡s visible */
Â  Â  Â  cursor:pointer;
Â  Â  Â  box-shadow:0 4px 10px rgba(0,0,0,0.2);
Â  Â  Â  transition:transform 0.15s ease, box-shadow 0.15s ease;
Â  Â  }
Â  Â  .swatch:hover, .swatch:active{ transform:scale(1.1); box-shadow:0 6px 15px rgba(0,0,0,0.3); }

Â  Â  /* Buscador pendientes 3.6 */
Â  Â  .search-row{ display:flex; gap:10px; margin-bottom:15px; flex-wrap:wrap; }
Â  Â  .search-row input{ flex:1; min-width: 200px; }

Â  Â  /* Banner saludo 6.5 */
Â  Â  #helloBanner{
Â  Â  Â  display:none; margin:-8px 0 15px 0; font-weight:800; font-size: 20px; color:var(--primary);
Â  Â  Â  padding: 10px 0;
Â  Â  }

Â  </style>
Â  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap">
</head>
<body>
Â  <div id="netBanner">ğŸ“¡ Sin conexiÃ³n â€” los pedidos se guardan localmente</div>
Â  <header>
Â  Â  <div style="display: flex; align-items: center; gap: 10px;">
Â  Â  Â  <span>ğŸ›’ Pedidos ML</span>
Â  Â  Â  <span id="connDot" class="offline"></span>
Â  Â  </div>
Â  Â  <span id="dailyCounter">Hoy: 0</span> Â  </header>

Â  <main id="nuevoPedido">
Â  Â  <div id="helloBanner"></div>

Â  Â  Â  Â  <div class="theme-row">
Â  Â  Â  <span style="font-weight:700;">ğŸ¨ Tema:</span>
Â  Â  Â  <div class="swatch" data-color="#0d6efd" title="Azul (Pred)" style="background:#0d6efd"></div>
Â  Â  Â  <div class="swatch" data-color="#10b981" title="Esmeralda" style="background:#10b981"></div>
Â  Â  Â  <div class="swatch" data-color="#ef4444" title="Rojo" style="background:#ef4444"></div>
Â  Â  Â  <div class="swatch" data-color="#7c3aed" title="Violeta" style="background:#7c3aed"></div>
Â  Â  </div>

Â  Â  <div class="row show-check" id="rowFecha">
Â  Â  Â  <label>ğŸ“… Fecha de entrega <span class="checkmark">âœ…</span></label>
Â  Â  Â  <input type="date" id="fechaEntrega" />
Â  Â  </div>

Â  Â  <div class="row show-check" id="rowCliente">
Â  Â  Â  <label>ğŸ§¾ NÃºmero de cliente <span class="checkmark">âœ…</span></label>
Â  Â  Â  <input type="number" inputmode="numeric" id="numeroCliente" placeholder="Ej: 10331 (Solo nÃºmeros)" />
Â  Â  </div>

Â  Â  <div class="row show-check" id="rowVendedor">
Â  Â  Â  <label>ğŸ‘¤ Nombre del vendedor <span class="checkmark">âœ…</span></label>
Â  Â  Â  <input type="text" id="nombreVendedor" placeholder="Ej: MARTIN" />
Â  Â  </div>

Â  Â  <div class="row show-check" id="rowProductos">
Â  Â  Â  <label>ğŸ“¦ Productos solicitados <span class="checkmark">âœ…</span></label>
Â  Â  Â  <textarea id="productos" rows="4" placeholder="Detalle de productos o SKUs (Separados por lÃ­nea o coma)"></textarea>
Â  Â  </div>

Â  Â  <div class="row" id="rowObs">
Â  Â  Â  <label>ğŸ—’ï¸ Observaciones</label>
Â  Â  Â  <textarea id="observaciones" rows="2" placeholder="Notas adicionales o requerimientos especiales"></textarea>
Â  Â  </div>

Â  Â  <div class="row">
Â  Â  Â  <label style="display: flex; align-items: center; gap: 8px; color: var(--text); font-weight: 400; font-size: 16px;">
Â  Â  Â  Â  <input type="checkbox" id="shareWA" style="width: 20px; height: 20px; margin: 0; padding: 0; border-radius: 6px;" />
Â  Â  Â  Â  Enviar resumen por WhatsApp al Laura
Â  Â  Â  </label>
Â  Â  </div>

Â  Â  <div class="toolbar">
Â  Â  Â  <button id="btnEnviar" class="btn">Enviar pedido</button>
Â  Â  Â  <button id="btnNuevoLote" class="btn-secondary" title="3.9 Carga masiva">â• Agregar otro (mismo dÃ­a/vendedor)</button>
Â  Â  </div>
Â  </main>

Â  Â  <main id="pendientes" style="display:none;">
Â  Â  <h3>ğŸ“‹ Pedidos pendientes</h3>

Â  Â  <div class="search-row">
Â  Â  Â  <input id="searchPend" type="search" placeholder="Buscar por cliente o vendedor..." />
Â  Â  Â  <button id="btnSyncHoy" class="btn-secondary" title="8.3 Reenviar solo los de hoy" style="flex-basis: 80px; min-width: 80px;">Hoy</button>
Â  Â  Â  <button id="btnReintentarTodos" class="btn" style="flex-basis: 120px; min-width: 120px;">Reintentar todos</button>
Â  Â  </div>

Â  Â  <div id="listaPendientes"></div>
Â  </main>

Â  Â  <main id="estadisticas" style="display:none;">
Â  Â  <h3>ğŸ“Š EstadÃ­sticas (este dispositivo)</h3>
Â  Â  <div class="stats-grid">
Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  <div class="stat-title">Enviados</div>
Â  Â  Â  Â  <div id="statEnviados" class="stat-value">0</div>
Â  Â  Â  Â  <div class="bar"><div id="barEnviados" class="fill" style="width:0%"></div></div>
Â  Â  Â  </div>
Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  <div class="stat-title">Pendientes</div>
Â  Â  Â  Â  <div id="statPendientes" class="stat-value">0</div>
Â  Â  Â  Â  <div class="bar"><div id="barPendientes" class="fill" style="width:0%"></div></div>
Â  Â  Â  </div>
Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  <div class="stat-title">Reenviados</div>
Â  Â  Â  Â  <div id="statReenviados" class="stat-value">0</div>
Â  Â  Â  Â  <div class="bar"><div id="barReenviados" class="fill" style="width:0%"></div></div>
Â  Â  Â  </div>
Â  Â  Â  <div class="stat-card">
Â  Â  Â  Â  <div class="stat-title">% Ã‰xito</div>
Â  Â  Â  Â  <div id="statExito" class="stat-value">0%</div>
Â  Â  Â  Â  <div class="bar"><div id="barExito" class="fill" style="width:0%"></div></div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="stat-card" style="margin-top:15px;">
Â  Â  Â  <div class="stat-title">Promedio de pedidos enviados por dÃ­a (5.1)</div>
Â  Â  Â  <div id="statPromedio" class="stat-value">0</div>
Â  Â  </div>
Â  </main>

Â  <div class="bottom-nav">
Â  Â  <button id="btnNuevo" class="tab-btn active">Nuevo</button>
Â  Â  <button id="btnVerPendientes" class="tab-btn">Pendientes</button>
Â  Â  <button id="btnVerEstadisticas" class="tab-btn">EstadÃ­sticas</button>
Â  </div>

Â  <div class="toast" id="toast"></div>

Â  Â  <div id="loadingOverlay">
Â  Â  <div class="spinner"></div>
Â  </div>

Â  Â  <div id="confirmOverlay">
Â  Â  <div class="success-box">
Â  Â  Â  <div class="success-icon">âœ¨</div> Â  Â  Â  <h2 style="margin:15px 0 0 0; font-size: 26px;">Â¡Pedido Enviado!</h2>
Â  Â  Â  <p style="opacity:.8;margin:8px 0 0 0; font-size: 17px;">Registro exitoso y guardado en la nube.</p>
Â  Â  </div>
Â  </div>

Â  <script>
Â  Â  // NO SE MODIFICA NINGUNA FUNCIÃ“N DE LÃ“GICA
Â  Â  // SOLO SE AÃ‘ADE LÃ“GICA DE CONTADOR DIARIO Y SPINNER VISUAL

Â  Â  // ==== CONFIG ====
Â  Â  const BACKEND_URL = "https://script.google.com/macros/s/AKfycbxPAwRf6K5d7xf-UfcM79wVOE1aMGfn6zT0pp_rF6Ta6qAGoCO8ZIEe2RWLlVP1WRIxEg/exec";

Â  Â  // ==== ELEMENTOS ====
Â  Â  const $ = id => document.getElementById(id);
Â  Â  const fechaEntrega = $("fechaEntrega");
Â  Â  const numeroCliente = $("numeroCliente");
Â  Â  const nombreVendedor = $("nombreVendedor");
Â  Â  const productos = $("productos");
Â  Â  const observaciones = $("observaciones");
Â  Â  const btnEnviar = $("btnEnviar");
Â  Â  const btnNuevoLote = $("btnNuevoLote");
Â  Â  const toast = $("toast");
Â  Â  const connDot = $("connDot");
Â  Â  const netBanner = $("netBanner");
Â  Â  const helloBanner = $("helloBanner");
Â  Â  const shareWA = $("shareWA");
Â  Â  const searchPend = $("searchPend");
Â  Â  const loadingOverlay = $("loadingOverlay"); // Nuevo Elemento

Â  Â  // ==== CONTADOR DIARIO (NUEVO) ====
Â  Â  const dailyCounter = $("dailyCounter");
Â  Â  function getDailyCount(){
Â  Â  Â  const today = new Date().toISOString().slice(0,10);
Â  Â  Â  const stored = JSON.parse(localStorage.getItem("dailyCount") || '{}');
Â  Â  Â  if(stored.date !== today){
Â  Â  Â  Â  localStorage.setItem("dailyCount", JSON.stringify({date: today, count: 0}));
Â  Â  Â  Â  return 0;
Â  Â  Â  }
Â  Â  Â  return stored.count;
Â  Â  }

Â  Â  function incDailyCount(){
Â  Â  Â  const today = new Date().toISOString().slice(0,10);
Â  Â  Â  const stored = JSON.parse(localStorage.getItem("dailyCount") || '{}');
Â  Â  Â  const newCount = (stored.date === today ? stored.count : 0) + 1;
Â  Â  Â  localStorage.setItem("dailyCount", JSON.stringify({date: today, count: newCount}));
Â  Â  Â  updateDailyCounter();
Â  Â  }

Â  Â  function updateDailyCounter(){
Â  Â  Â  dailyCounter.textContent = `Hoy: ${getDailyCount()}`;
Â  Â  }

Â  Â  // ==== SPINNER (NUEVO) ====
Â  Â  function showLoading(){ loadingOverlay.style.display = "flex"; }
Â  Â  function hideLoading(){ loadingOverlay.style.display = "none"; }


Â  Â  // ==== SONIDO 2.1/2.4 ====
Â  Â  const sndOk = new Audio("data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAA"); // placeholder corto
Â  Â  function vib(ms=60){ if('vibrate' in navigator) navigator.vibrate(ms); }
Â  Â  function playOk(){ try{ sndOk.currentTime=0; sndOk.play(); }catch{} }

Â  Â  // ==== TOAST MEJORADO ====
Â  Â  function showToast(msg, type="info"){
Â  Â  Â  toast.textContent = msg;
Â  Â  Â  toast.style.background = type==="error" ? "var(--error)" : (type==="ok" ? "var(--ok)" : "var(--warn)");
Â  Â  Â  toast.style.color = type==="error" ? "#fff" : (type==="ok" ? "#fff" : "var(--text)");
Â  Â  Â  toast.classList.add("show");
Â  Â  Â  setTimeout(()=> toast.classList.remove("show"), 3500);
Â  Â  }

Â  Â  // ==== THEME 2.8 ====
Â  Â  (()=>{
Â  Â  Â  const stored = localStorage.getItem("themeColor");
Â  Â  Â  if(stored) document.documentElement.style.setProperty("--primary", stored);
Â  Â  Â  document.querySelectorAll(".swatch").forEach(s=>{
Â  Â  Â  Â  s.addEventListener("click", ()=>{
Â  Â  Â  Â  Â  const c = s.getAttribute("data-color");
Â  Â  Â  Â  Â  document.documentElement.style.setProperty("--primary", c);
Â  Â  Â  Â  Â  localStorage.setItem("themeColor", c);
Â  Â  Â  Â  });
Â  Â  Â  });
Â  Â  })();

Â  Â  // ==== CHECKLIST 2.9 ====
Â  Â  function markOk(inputEl, rowId){
Â  Â  Â  const row = $(rowId);
Â  Â  Â  if(!row) return;
Â  Â  Â  const ok = inputEl.value && String(inputEl.value).trim() !== "";
Â  Â  Â  if(ok) inputEl.classList.add("field-ok");
Â  Â  Â  else inputEl.classList.remove("field-ok");
Â  Â  }
Â  Â  [ [fechaEntrega,"rowFecha"], [numeroCliente,"rowCliente"], [nombreVendedor,"rowVendedor"], [productos,"rowProductos"] ]
Â  Â  Â  .forEach(([el,row])=> el.addEventListener("input", ()=> markOk(el,row)));

Â  Â  // ==== STORAGE (LÃ³gica Intacta) ====
Â  Â  const getQueue = () => JSON.parse(localStorage.getItem("pedidosPendientes") || "[]");
Â  Â  const setQueue = arr => localStorage.setItem("pedidosPendientes", JSON.stringify(arr));
Â  Â  const getStats = () => JSON.parse(localStorage.getItem("statsPedidos") || '{"enviados":0,"reenviados":0}');
Â  Â  const setStats = s => localStorage.setItem("statsPedidos", JSON.stringify(s));
Â  Â  const getHistory = () => JSON.parse(localStorage.getItem("historialEnviados") || "[]");
Â  Â  const setHistory = h => localStorage.setItem("historialEnviados", JSON.stringify(h));
Â  Â  const getSentIds = () => new Set(JSON.parse(localStorage.getItem("idsEnviados") || "[]"));
Â  Â  const addSentId = (id) => {
Â  Â  Â  const arr = JSON.parse(localStorage.getItem("idsEnviados") || "[]");
Â  Â  Â  if(!arr.includes(id)) arr.push(id);
Â  Â  Â  localStorage.setItem("idsEnviados", JSON.stringify(arr));
Â  Â  }

Â  Â  // 3.4 Guardado automÃ¡tico del borrador (LÃ³gica Intacta)
Â  Â  const DRAFT_KEY = "draftPedido";
Â  Â  function saveDraft(){
Â  Â  Â  const d = {
Â  Â  Â  Â  fechaEntrega: fechaEntrega.value,
Â  Â  Â  Â  numeroCliente: numeroCliente.value,
Â  Â  Â  Â  nombreVendedor: nombreVendedor.value,
Â  Â  Â  Â  productos: productos.value,
Â  Â  Â  Â  observaciones: observaciones.value
Â  Â  Â  };
Â  Â  Â  localStorage.setItem(DRAFT_KEY, JSON.stringify(d));
Â  Â  }
Â  Â  function loadDraft(){
Â  Â  Â  const raw = localStorage.getItem(DRAFT_KEY);
Â  Â  Â  if(!raw) return;
Â  Â  Â  try{
Â  Â  Â  Â  const d = JSON.parse(raw);
Â  Â  Â  Â  fechaEntrega.value = d.fechaEntrega || fechaEntrega.value;
Â  Â  Â  Â  numeroCliente.value = d.numeroCliente || "";
Â  Â  Â  Â  nombreVendedor.value = d.nombreVendedor || nombreVendedor.value;
Â  Â  Â  Â  productos.value = d.productos || "";
Â  Â  Â  Â  observaciones.value = d.observaciones || "";
Â  Â  Â  }catch{}
Â  Â  }
Â  Â  [fechaEntrega,numeroCliente,nombreVendedor,productos,observaciones].forEach(el=> el.addEventListener("input", saveDraft));

Â  Â  // 3.1 / 3.2 Auto-completar (LÃ³gica Intacta)
Â  Â  (function prefill(){
Â  Â  Â  const vend = localStorage.getItem("vendedorNombre");
Â  Â  Â  if(vend) nombreVendedor.value = vend;
Â  Â  Â  const today = new Date().toISOString().slice(0,10);
Â  Â  Â  if(!fechaEntrega.value) fechaEntrega.value = today;
Â  Â  Â  // saludo 6.5
Â  Â  Â  helloBanner.style.display = vend ? "block" : "none";
Â  Â  Â  if(vend) helloBanner.textContent = `Hola ${vend} ğŸ‘‹`;
Â  Â  })();

Â  Â  // 3.3 ValidaciÃ³n de nÃºmero de cliente (LÃ³gica Intacta)
Â  Â  numeroCliente.addEventListener("input", ()=>{
Â  Â  Â  numeroCliente.value = numeroCliente.value.replace(/[^\d]/g,"");
Â  Â  });

Â  Â  // ==== ESTADÃSTICAS + 5.1 Promedio por dÃ­a (LÃ³gica Intacta) ====
Â  Â  function renderStats(){
Â  Â  Â  const s = getStats();
Â  Â  Â  const pend = getQueue().length;
Â  Â  Â  const enviados = s.enviados||0, reenviados = s.reenviados||0;
Â  Â  Â  const total = enviados + reenviados + pend;
Â  Â  Â  const ok = enviados + reenviados;
Â  Â  Â  const exito = total>0 ? Math.round(ok*100/total) : 0;

Â  Â  Â  $("statEnviados").textContent = enviados;
Â  Â  Â  $("statPendientes").textContent = pend;
Â  Â  Â  $("statReenviados").textContent = reenviados;
Â  Â  Â  $("statExito").textContent = exito + "%";

Â  Â  Â  $("barEnviados").style.width = total>0 ? (enviados*100/total)+"%" : "0%";
Â  Â  Â  $("barPendientes").style.width = total>0 ? (pend*100/total)+"%" : "0%";
Â  Â  Â  $("barReenviados").style.width = total>0 ? (reenviados*100/total)+"%" : "0%";
Â  Â  Â  $("barExito").style.width = exito+"%";

Â  Â  Â  // promedio por dÃ­a (historial)
Â  Â  Â  const hist = getHistory();
Â  Â  Â  const byDay = {};
Â  Â  Â  hist.forEach(h=>{
Â  Â  Â  Â  const day = (new Date(h.timestamp)).toISOString().slice(0,10);
Â  Â  Â  Â  byDay[day] = (byDay[day]||0)+1;
Â  Â  Â  });
Â  Â  Â  const days = Object.keys(byDay).length || 1;
Â  Â  Â  const totalEnv = hist.length;
Â  Â  Â  $("statPromedio").textContent = (totalEnv/days).toFixed(1);
Â  Â  }

Â  Â  function incStat(k){ const s = getStats(); s[k]=(s[k]||0)+1; setStats(s); renderStats(); }

Â  Â  // ==== PENDIENTES + 3.6 bÃºsqueda + 8.3 sync hoy (LÃ³gica Intacta) ====
Â  Â  function cardHtml(p){
Â  Â  Â  return `<div class="pedido-card">
Â  Â  Â  Â  <b>Cliente:</b> ${p.numeroCliente||"â€”"}<br>
Â  Â  Â  Â  <b>Vendedor:</b> ${p.nombreVendedor||"â€”"}<br>
Â  Â  Â  Â  <b>Fecha:</b> ${p.fechaEntrega||"â€”"}<br>
Â  Â  Â  Â  <hr style="border:none;border-top:1px solid var(--muted);margin:12px 0; opacity: 0.3;">
Â  Â  Â  Â  <div class="toolbar" style="gap:10px; margin: 0; flex-wrap: nowrap;">
Â  Â  Â  Â  Â  <button class="btn" style="padding: 12px; font-size: 16px;" onclick="reenviarPedido('${p.id}')">ğŸ”„ Reenviar</button>
Â  Â  Â  Â  Â  <button class="btn-secondary" style="padding: 12px; font-size: 16px;" onclick="eliminarPendiente('${p.id}')">ğŸ—‘ï¸ Eliminar</button>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>`;
Â  Â  }

Â  Â  function cargarPendientes(){
Â  Â  Â  const cont = $("listaPendientes");
Â  Â  Â  const q = getQueue();
Â  Â  Â  const qf = searchPend.value.trim().toLowerCase();
Â  Â  Â  let filtered = q;
Â  Â  Â  if(qf){
Â  Â  Â  Â  filtered = q.filter(p =>
Â  Â  Â  Â  Â  String(p.numeroCliente||"").toLowerCase().includes(qf) ||
Â  Â  Â  Â  Â  String(p.nombreVendedor||"").toLowerCase().includes(qf)
Â  Â  Â  Â  );
Â  Â  Â  }
Â  Â  Â  cont.innerHTML = filtered.length ? filtered.map(cardHtml).join("") : "<p style='text-align: center; color: var(--muted); padding: 20px;'>No hay pedidos pendientes. Â¡Excelente trabajo! ğŸ¥³</p>";
Â  Â  Â  renderStats();

Â  Â  Â  // 6.3 alerta si hay muchos pendientes
Â  Â  Â  if(q.length>10) showToast("âš ï¸ Hay muchos pendientes (>10). Recomendado sincronizar.", "info");
Â  Â  }
Â  Â  searchPend.addEventListener("input", cargarPendientes);

Â  Â  // ==== CONEXIÃ“N (LÃ³gica Intacta) ====
Â  Â  function setOnlineStatus(on){
Â  Â  Â  netBanner.style.display = on ? "none" : "block";
Â  Â  Â  connDot.className = on ? "online" : "offline";
Â  Â  }
Â  Â  window.addEventListener("online", async ()=>{
Â  Â  Â  setOnlineStatus(true);
Â  Â  Â  await syncPendientes(true); // 2.6 parpadeo al sincronizar
Â  Â  });
Â  Â  window.addEventListener("offline", ()=> setOnlineStatus(false));
Â  Â  setOnlineStatus(navigator.onLine);

Â  Â  // ==== NOTIFICACIONES (LÃ³gica Intacta) ====
Â  Â  async function ensureNotiPerm(){
Â  Â  Â  try{
Â  Â  Â  Â  if(!("Notification" in window)) return;
Â  Â  Â  Â  if(Notification.permission==="granted") return;
Â  Â  Â  Â  if(Notification.permission!=="denied") await Notification.requestPermission();
Â  Â  Â  }catch{}
Â  Â  }
Â  Â  function notify(title, body){
Â  Â  Â  try{
Â  Â  Â  Â  if(("Notification" in window) && Notification.permission==="granted"){
Â  Â  Â  Â  Â  new Notification(title, { body });
Â  Â  Â  Â  }
Â  Â  Â  }catch{}
Â  Â  }

Â  Â // ==== ENVÃO AL BACKEND (LÃ³gica Intacta) ====
async function postPedido(pedido) {
Â  try {
Â  Â  await fetch(BACKEND_URL, {
Â  Â  Â  method: "POST",
Â  Â  Â  mode: "no-cors",
Â  Â  Â  headers: { "Content-Type": "text/plain" },
Â  Â  Â  body: JSON.stringify(pedido)
Â  Â  });
Â  Â  console.log("âœ… Pedido enviado (modo no-cors)");
Â  Â  return { status: "ok" };
Â  } catch (e) {
Â  Â  console.error("âŒ Error en fetch:", e);
Â  Â  throw e;
Â  }
}


Â  Â  // ==== COLA + REENVÃO (LÃ³gica Intacta, solo spinner) ====
Â  Â  async function reenviarPedido(id){
Â  Â  Â  vib();
Â  Â  Â  if(!navigator.onLine){ showToast("Sin conexiÃ³n para reenviar", "error"); return; }
Â  Â  Â  showLoading(); // Mostrar spinner
Â  Â  Â  const q = getQueue();
Â  Â  Â  const p = q.find(x => String(x.id)===String(id));
Â  Â  Â  if(!p) { hideLoading(); return; }
Â  Â  Â  try{
Â  Â  Â  Â  const data = await postPedido(p);
Â  Â  Â  Â  setQueue(q.filter(x => String(x.id)!==String(id)));
Â  Â  Â  Â  incStat("reenviados");
Â  Â  Â  Â  cargarPendientes();
Â  Â  Â  Â  showToast(data.status==="duplicate" ? "Duplicado detectado (descartado)" : "Pedido reenviado", data.status==="duplicate"?"info":"ok");
Â  Â  Â  Â  connDot.className = "syncing"; setTimeout(()=>setOnlineStatus(true), 700);
Â  Â  Â  Â  notify("ReenvÃ­o OK","El pedido fue reenviado correctamente");
Â  Â  Â  }catch(e){
Â  Â  Â  Â  console.error(e);
Â  Â  Â  Â  showToast("Error al reenviar", "error");
Â  Â  Â  } finally {
Â  Â  Â  Â  hideLoading(); // Ocultar spinner
Â  Â  Â  }
Â  Â  }
Â  Â  window.reenviarPedido = reenviarPedido; // para los botones inline

Â  Â  function eliminarPendiente(id){
Â  Â  Â  const q = getQueue().filter(x => String(x.id)!==String(id));
Â  Â  Â  setQueue(q);
Â  Â  Â  cargarPendientes();
Â  Â  Â  showToast("Pedido eliminado de pendientes", "info");
Â  Â  }
Â  Â  window.eliminarPendiente = eliminarPendiente;

Â  Â  async function reintentarTodos(filterToday=false){
Â  Â  Â  if(!navigator.onLine){ showToast("Sin conexiÃ³n", "error"); return; }
Â  Â  Â  showLoading(); // Mostrar spinner
Â  Â  Â  const q = getQueue();
Â  Â  Â  if(!q.length){ hideLoading(); showToast("No hay pendientes", "info"); return; }
Â  Â  Â  const today = new Date().toISOString().slice(0,10);
Â  Â  Â  let toSend = q;
Â  Â  Â  if(filterToday){
Â  Â  Â  Â  toSend = q.filter(p => (p.fechaEntrega||"").slice(0,10)===today);
Â  Â  Â  Â  if(!toSend.length){ hideLoading(); showToast("No hay pendientes de hoy", "info"); return; }
Â  Â  Â  }
Â  Â  Â  for(const p of [...toSend]){
Â  Â  Â  Â  try{
Â  Â  Â  Â  Â  const data = await postPedido(p);
Â  Â  Â  Â  Â  setQueue(getQueue().filter(x => String(x.id)!==String(p.id)));
Â  Â  Â  Â  Â  incStat("reenviados");
Â  Â  Â  Â  }catch{/* se queda en cola */}
Â  Â  Â  }
Â  Â  Â  cargarPendientes();
Â  Â  Â  showToast(filterToday ? "Reenviados los de hoy" : "Reintento completo", "ok");
Â  Â  Â  connDot.className = "syncing"; setTimeout(()=>setOnlineStatus(true), 700);
Â  Â  Â  notify("SincronizaciÃ³n","Se reenviaron pedidos pendientes");
Â  Â  Â  hideLoading(); // Ocultar spinner
Â  Â  }
Â  Â  $("btnReintentarTodos").addEventListener("click", ()=> reintentarTodos(false));
Â  Â  $("btnSyncHoy").addEventListener("click", ()=> reintentarTodos(true));

Â  Â  // ==== ENVÃO NUEVO PEDIDO (LÃ³gica Intacta, solo visual) ====
Â  Â  let sending = false;
Â  Â  const lastSent = getSentIds();

Â  Â  function buildPedido(){
Â  Â  Â  return {
Â  Â  Â  Â  id: Date.now(),
Â  Â  Â  Â  fechaEntrega: fechaEntrega.value,
Â  Â  Â  Â  numeroCliente: (numeroCliente.value||"").trim(),
Â  Â  Â  Â  nombreVendedor: (nombreVendedor.value||"").trim(),
Â  Â  Â  Â  productos: (productos.value||"").trim(),
Â  Â  Â  Â  observaciones: (observaciones.value||"").trim()
Â  Â  Â  };
Â  Â  }

Â  Â  function validPedido(p){
Â  Â  Â  return p.fechaEntrega && p.numeroCliente && p.nombreVendedor && p.productos;
Â  Â  }

Â  Â  function guardarLocal(p){
Â  Â  Â  const q = getQueue(); q.push(p); setQueue(q);
Â  Â  Â  renderStats();
Â  Â  Â  showToast("ğŸ“¡ Guardado local por conexiÃ³n", "info");
Â  Â  }

Â  Â async function enviarPedido(p, options = { mass: false }) {
Â  if (sending) return;
Â  if (lastSent.has(p.id)) {
Â  Â  showToast("Duplicado detectado (id repetido)", "info");
Â  Â  return;
Â  }

Â  // ğŸ”’ Bloqueo de envÃ­o y Muestra de Spinner
Â  sending = true;
Â  btnEnviar.disabled = true;
Â  btnEnviar.textContent = "Enviando...";
Â  showLoading(); // Mostrar el spinner

Â  try {
Â  Â  if (!navigator.onLine) throw new Error("offline");

Â  Â  // âš¡ EnvÃ­o sin esperar respuesta (modo no-cors)
Â  Â  await postPedido(p); // Se usa await para que el finally se ejecute DESPUÃ‰S de enviar.
Â  Â  console.log("ğŸ“¤ Pedido enviado (no-cors)");

Â  Â  // === LÃ³gica de Ã‰xito ===
Â  Â  addSentId(p.id);
Â  Â  lastSent.add(p.id);

Â  Â  if (p.nombreVendedor) localStorage.setItem("vendedorNombre", p.nombreVendedor);
Â  Â  helloBanner.style.display = "block";
Â  Â  helloBanner.textContent = `Hola ${p.nombreVendedor} ğŸ‘‹`;

Â  Â  const hist = getHistory();
Â  Â  hist.push({
Â  Â  Â  id: p.id,
Â  Â  Â  timestamp: Date.now(),
Â  Â  Â  numeroCliente: p.numeroCliente,
Â  Â  Â  vendedor: p.nombreVendedor
Â  Â  });
Â  Â  setHistory(hist);

Â  Â  incStat("enviados");
Â  Â  incDailyCount(); // Incrementar contador diario
Â  Â  playOk();
Â  Â  vib(140);
Â  Â  hideLoading(); // Ocultar spinner antes de mostrar el Ã©xito
Â  Â  showSuccess(); // Mostrar overlay de Ã©xito
Â  Â  notify("Pedido enviado", "Se registrÃ³ correctamente");

Â  Â  if (shareWA.checked) {
Â  Â  Â  const txt = `Pedido ML%0ACliente: ${encodeURIComponent(p.numeroCliente)}%0AVendedor: ${encodeURIComponent(p.nombreVendedor)}%0AFecha: ${encodeURIComponent(p.fechaEntrega)}%0AProductos:%0A${encodeURIComponent(p.productos)}`;
Â  Â  Â  const whatsapp = `https://wa.me/5491133395487?text=${txt}`;
Â  Â  Â  window.open(whatsapp, "_blank");
Â  Â  }

Â  Â  if (options.mass) {
Â  Â  Â  numeroCliente.value = "";
Â  Â  Â  productos.value = "";
Â  Â  Â  observaciones.value = "";
Â  Â  Â  productos.focus();
Â  Â  } else {
Â  Â  Â  fechaEntrega.value = "";
Â  Â  Â  numeroCliente.value = "";
Â  Â  Â  nombreVendedor.value = "";
Â  Â  Â  productos.value = "";
Â  Â  Â  observaciones.value = "";
Â  Â  }
Â  Â  saveDraft();
Â  } catch (e) {
Â  Â  console.error("âŒ Error en envÃ­o:", e);
Â  Â  hideLoading(); // Ocultar spinner en caso de error
Â  Â  guardarLocal(p);
Â  } finally {
Â  Â  sending = false;
Â  Â  btnEnviar.disabled = false;
Â  Â  btnEnviar.textContent = "Enviar pedido";
Â  }
}

Â  Â  // 2.1 Overlay Ã©xito (LÃ³gica Intacta)
Â  Â  function showSuccess(){
Â  Â  Â  const ov = $("confirmOverlay");
Â  Â  Â  ov.style.display = "flex";
Â  Â  Â  setTimeout(()=> ov.style.display = "none", 1600);
Â  Â  }

Â  Â  btnEnviar.addEventListener("click", ()=>{
Â  Â  Â  vib();
Â  Â  Â  const p = buildPedido();
Â  Â  Â  if(!validPedido(p)){ showToast("CompletÃ¡ todos los campos obligatorios","error"); return; }
Â  Â  Â  enviarPedido(p, {mass:false});
Â  Â  });

Â  Â  btnNuevoLote.addEventListener("click", ()=>{
Â  Â  Â  vib();
Â  Â  Â  const p = buildPedido();
Â  Â  Â  if(!validPedido(p)){ showToast("CompletÃ¡ todos los campos obligatorios","error"); return; }
Â  Â  Â  enviarPedido(p, {mass:true});
Â  Â  });

Â  Â  // ==== AUTO-SYNC (LÃ³gica Intacta) ====
Â  Â  async function syncPendientes(animate=false){
Â  Â  Â  if(!navigator.onLine) return;
Â  Â  Â  const q = getQueue(); if(!q.length) return;

Â  Â  Â  // showLoading(); // Descomentar si se quiere mostrar el spinner en auto-sync
Â  Â  Â  if(animate){ connDot.className = "syncing"; }

Â  Â  Â  for(const p of [...q]){
Â  Â  Â  Â  try{
Â  Â  Â  Â  Â  await postPedido(p);
Â  Â  Â  Â  Â  setQueue(getQueue().filter(x => x.id!==p.id));
Â  Â  Â  Â  Â  incStat("reenviados");
Â  Â  Â  Â  }catch{}
Â  Â  Â  }
Â  Â  Â  // hideLoading(); // Descomentar si se mostrÃ³ el spinner

Â  Â  Â  cargarPendientes();
Â  Â  Â  if(animate){ setTimeout(()=> setOnlineStatus(true), 700); }
Â  Â  Â  notify("Sincronizado","Se reenviaron pedidos pendientes");
Â  Â  }

Â  Â  // ==== TABS (LÃ³gica Intacta) ====
Â  Â  const sections = {nuevo:$("nuevoPedido"), pend:$("pendientes"), stats:$("estadisticas")};
Â  Â  const tabs = {nuevo:$("btnNuevo"), pend:$("btnVerPendientes"), stats:$("btnVerEstadisticas")};
Â  Â  function setTab(name){
Â  Â  Â  vib();
Â  Â  Â  Object.values(tabs).forEach(b=> b.classList.remove("active"));
Â  Â  Â  Object.values(sections).forEach(s=> s.style.display="none");
Â  Â  Â  tabs[name].classList.add("active");
Â  Â  Â  sections[name].style.display="block";
Â  Â  Â  if(name==="pend") cargarPendientes();
Â  Â  Â  if(name==="stats") renderStats();
Â  Â  }
Â  Â  tabs.nuevo.onclick = ()=> setTab("nuevo");
Â  Â  tabs.pend.onclick = ()=> setTab("pend");
Â  Â  tabs.stats.onclick = ()=> setTab("stats");

Â  Â  // ==== PROTECCIÃ“N CIERRE 4.2 (LÃ³gica Intacta) ====
Â  Â  window.addEventListener("beforeunload", (e)=>{
Â  Â  Â  if(getQueue().length>0){
Â  Â  Â  Â  e.preventDefault(); e.returnValue = "";
Â  Â  Â  }
Â  Â  });

Â  Â  // ==== RECORDATORIO DIARIO 6.4 (LÃ³gica Intacta) ====
Â  Â  (function dailyReminder(){
Â  Â  Â  const key = "reminderDate";
Â  Â  Â  const today = new Date().toISOString().slice(0,10);
Â  Â  Â  const last = localStorage.getItem(key);
Â  Â  Â  if(last!==today && getQueue().length>0){
Â  Â  Â  Â  showToast("â° Tienes pedidos sin enviar. Recordatorio diario.", "info");
Â  Â  Â  Â  localStorage.setItem(key, today);
Â  Â  Â  }
Â  Â  })();

Â  Â  // ==== INICIO ====
Â  Â  loadDraft();
Â  Â  renderStats();
Â  Â  ensureNotiPerm();
Â  Â  updateDailyCounter(); // Cargar contador al inicio
Â  Â  setTab("nuevo");

Â  Â  // SW / PWA
Â  Â  if('serviceWorker' in navigator){
Â  Â  Â  navigator.serviceWorker.register('service-worker.js')
Â  Â  Â  Â  .then(()=>console.log('âœ… Service Worker registrado'))
Â  Â  Â  Â  .catch(err=>console.log('âŒ SW error',err));
Â  Â  }

Â  Â  // Exponer para inline
Â  Â  window.reintentarTodos = reintentarTodos;
Â  </script>
</body>
</html>
