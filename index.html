<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pedidos ML</title>
  <meta name="theme-color" content="#ff7f00" />
  <link rel="manifest" href="manifest.webmanifest" />

  <style>
    :root {
      --primary: #ff7f00;
      --bg: #0b0f14;
      --text: #f5f5f5;
      --card: #1a1a1a;
      --muted: #a3a3a3;
      --shadow: 0 4px 10px rgba(0,0,0,0.3);
    }

    [data-theme='light'] {
      --primary: #1e3a8a;
      --bg: #f5f7fa;
      --text: #1f2937;
      --card: #ffffff;
      --muted: #6b7280;
      --shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    html, body {
      height: 100%;
      margin: 0;
      font-family: 'Segoe UI', Roboto, Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: background 0.4s, color 0.4s;
    }

    header {
      position: sticky;
      top: 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: var(--primary);
      color: #fff;
      padding: 14px 12px;
      font-size: 20px;
      font-weight: 700;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    #themeSwitch {
      appearance: none;
      width: 48px;
      height: 26px;
      background: #ccc;
      border-radius: 26px;
      position: relative;
      outline: none;
      cursor: pointer;
      transition: background 0.3s;
    }

    #themeSwitch::before {
      content: '';
      position: absolute;
      top: 3px;
      left: 3px;
      width: 20px;
      height: 20px;
      background: #fff;
      border-radius: 50%;
      transition: transform 0.3s;
    }

    #themeSwitch:checked {
      background: #ff7f00;
    }

    #themeSwitch:checked::before {
      transform: translateX(22px);
    }

    #connDot {
      width: 12px; height: 12px; border-radius: 50%;
      box-shadow: 0 0 0 3px rgba(255,255,255,0.25);
    }
    .online { background:#22c55e; }
    .offline { background:#ef4444; }

    main { padding: 18px; max-width: 860px; margin: 0 auto; }

    label { display:block; font-size:14px; color:var(--muted); margin-bottom:6px; }
    input, textarea {
      width:100%; box-sizing:border-box;
      font-size:16px; padding:12px;
      border-radius:12px; border:1px solid #cbd5e1;
      background:var(--card); color:var(--text);
      outline:none;
    }
    textarea { min-height:100px; resize:vertical; }

    .btn {
      display:block;
      width:100%;
      border:none;
      border-radius:14px;
      padding:16px;
      font-size:17px;
      font-weight:700;
      background:var(--primary);
      color:#fff;
      box-shadow:var(--shadow);
      cursor:pointer;
      margin-top:12px;
    }

    .btn:active { transform:scale(0.98); }

    .bottom-nav {
      position:fixed; left:0; right:0; bottom:0;
      background:var(--card);
      border-top:1px solid #333;
      display:flex; gap:8px; padding:10px;
    }

    .tab-btn {
      flex:1;
      border:none;
      border-radius:10px;
      padding:12px;
      font-weight:700;
      background:#333;
      color:#fff;
    }

    .tab-btn.active {
      background:var(--primary);
    }

    .pedido-card {
      background:var(--card);
      border-radius:12px;
      padding:14px;
      margin-bottom:12px;
      box-shadow:var(--shadow);
    }

    .stat-card {
      background:var(--card);
      border-radius:12px;
      padding:16px;
      text-align:center;
      margin:8px 0;
      box-shadow:var(--shadow);
    }

    #dailyCount {
      font-size:14px;
      background:rgba(255,255,255,0.15);
      padding:6px 10px;
      border-radius:12px;
    }

  </style>
</head>
<body>
  <header>
    <input type="checkbox" id="themeSwitch">
    <span>Pedidos ML</span>
    <div style="display:flex;align-items:center;gap:8px;">
      <span id="dailyCount">0 hoy</span>
      <div id="connDot" class="offline"></div>
    </div>
  </header>

  <main id="nuevoPedido">
    <div class="row">
      <label>üìÖ Fecha de entrega</label>
      <input type="date" id="fechaEntrega" />
    </div>
    <div class="row">
      <label>üßæ N√∫mero de cliente</label>
      <input type="number" id="numeroCliente" />
    </div>
    <div class="row">
      <label>üë§ Nombre del vendedor</label>
      <input type="text" id="nombreVendedor" />
    </div>
    <div class="row">
      <label>üì¶ Productos</label>
      <textarea id="productos"></textarea>
    </div>
    <div class="row">
      <label>üóíÔ∏è Observaciones</label>
      <textarea id="observaciones"></textarea>
    </div>
    <button id="btnEnviar" class="btn">Enviar pedido</button>
  </main>

  <main id="pendientes" style="display:none;">
    <h3>üìã Pendientes</h3>
    <div id="listaPendientes"></div>
  </main>

  <main id="estadisticas" style="display:none;">
    <h3>üìä Estad√≠sticas</h3>
    <div class="stat-card"><div>Enviados</div><div id="statEnviados">0</div></div>
    <div class="stat-card"><div>Pendientes</div><div id="statPendientes">0</div></div>
  </main>

  <div class="bottom-nav">
    <button id="btnNuevo" class="tab-btn active">Nuevo</button>
    <button id="btnPend" class="tab-btn">Pendientes</button>
    <button id="btnStats" class="tab-btn">Estad√≠sticas</button>
  </div>

  <script>
    const $ = id => document.getElementById(id);
    const themeSwitch = $("themeSwitch");
    const root = document.documentElement;
    const BACKEND_URL = "https://script.google.com/macros/s/AKfycbxPAwRf6K5d7xf-UfcM79wVOE1aMGfn6zT0pp_rF6Ta6qAGoCO8ZIEe2RWLlVP1WRIxEg/exec";

    const fechaEntrega = $("fechaEntrega");
    const numeroCliente = $("numeroCliente");
    const nombreVendedor = $("nombreVendedor");
    const productos = $("productos");
    const observaciones = $("observaciones");
    const btnEnviar = $("btnEnviar");
    const connDot = $("connDot");
    const dailyCount = $("dailyCount");

    const tabs = {
      nuevo: $("btnNuevo"),
      pend: $("btnPend"),
      stats: $("btnStats")
    };
    const sections = {
      nuevo: $("nuevoPedido"),
      pend: $("pendientes"),
      stats: $("estadisticas")
    };

    // Tema guardado
    const savedTheme = localStorage.getItem("theme") || "dark";
    root.dataset.theme = savedTheme;
    themeSwitch.checked = savedTheme === "dark" ? true : false;

    themeSwitch.addEventListener("change", () => {
      const mode = themeSwitch.checked ? "dark" : "light";
      root.dataset.theme = mode;
      localStorage.setItem("theme", mode);
    });

    function setTab(tab) {
      Object.values(tabs).forEach(b => b.classList.remove("active"));
      Object.values(sections).forEach(s => s.style.display = "none");
      tabs[tab].classList.add("active");
      sections[tab].style.display = "block";
    }

    tabs.nuevo.onclick = () => setTab("nuevo");
    tabs.pend.onclick = () => setTab("pend");
    tabs.stats.onclick = () => setTab("stats");

    // online/offline
    function setOnline(on) {
      connDot.className = on ? "online" : "offline";
    }
    setOnline(navigator.onLine);
    window.addEventListener("online", () => setOnline(true));
    window.addEventListener("offline", () => setOnline(false));

    // contador diario
    function updateDailyCount() {
      const today = new Date().toISOString().slice(0,10);
      const data = JSON.parse(localStorage.getItem("countData") || "{}");
      if (data.date !== today) {
        data.date = today;
        data.count = 0;
      }
      dailyCount.textContent = data.count + " hoy";
      localStorage.setItem("countData", JSON.stringify(data));
    }
    updateDailyCount();

    function incDailyCount() {
      const data = JSON.parse(localStorage.getItem("countData") || "{}");
      data.count = (data.count || 0) + 1;
      data.date = new Date().toISOString().slice(0,10);
      localStorage.setItem("countData", JSON.stringify(data));
      updateDailyCount();
    }

    // envio
    async function postPedido(pedido) {
      try {
        await fetch(BACKEND_URL, {
          method: "POST",
          mode: "no-cors",
          headers: { "Content-Type": "text/plain" },
          body: JSON.stringify(pedido)
        });
        return true;
      } catch (e) {
        console.error(e);
        return false;
      }
    }

    btnEnviar.addEventListener("click", async () => {
      const p = {
        id: Date.now(),
        fechaEntrega: fechaEntrega.value,
        numeroCliente: numeroCliente.value,
        nombreVendedor: nombreVendedor.value,
        productos: productos.value,
        observaciones: observaciones.value
      };
      if (!p.fechaEntrega || !p.numeroCliente || !p.nombreVendedor || !p.productos) {
        alert("Complet√° todos los campos");
        return;
      }
      await postPedido(p);
      incDailyCount();
      const vend = p.nombreVendedor;
      localStorage.setItem("vendedorNombre", vend);
      numeroCliente.value = "";
      productos.value = "";
      observaciones.value = "";
    });

    const vend = localStorage.getItem("vendedorNombre");
    if (vend) nombreVendedor.value = vend;

  </script>
</body>
</html>
