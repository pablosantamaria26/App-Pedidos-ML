<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Pedidos ML</title>
  <meta name="theme-color" content="#f59e0b" />
  <link rel="manifest" href="manifest.webmanifest" />

  <style>
    :root {
      --primary:#f59e0b;
      --bg:#0b0b0b;
      --text:#f8fafc;
      --card:#1a1a1a;
      --muted:#9ca3af;
      --shadow:0 4px 10px rgba(0,0,0,0.4);
      --accent:#f59e0b;
    }

    body[data-theme="light"] {
      --primary:#0d6efd;
      --bg:#f5f6f8;
      --text:#1f2937;
      --card:#ffffff;
      --muted:#6b7280;
      --shadow:0 2px 6px rgba(0,0,0,0.15);
      --accent:#0d6efd;
    }

    html,body {height:100%; margin:0; padding:0; font-family:'Segoe UI',Roboto,Arial,sans-serif; background:var(--bg); color:var(--text);}
    header {
      position:sticky; top:0; z-index:1000;
      display:flex; align-items:center; justify-content:space-between;
      padding:14px 16px;
      background:var(--primary); color:#fff; font-size:20px; font-weight:700;
      box-shadow:0 2px 6px rgba(0,0,0,0.3);
    }
    header span.title {flex:1; text-align:center;}
    #themeToggle { background:none; border:none; color:#fff; font-size:20px; cursor:pointer; }
    #counterBox { position:absolute; right:48px; top:50%; transform:translateY(-50%); background:rgba(255,255,255,0.2); padding:3px 10px; border-radius:20px; font-size:14px; font-weight:600; transition:transform 0.3s ease;}
    #counterBox.bump { transform:translateY(-50%) scale(1.3); }
    #connDot { position:absolute; right:12px; top:50%; transform:translateY(-50%); width:12px; height:12px; border-radius:50%; box-shadow:0 0 0 3px rgba(255,255,255,0.25);}
    .online{ background:#22c55e; } .offline{ background:#ef4444; } .syncing{ animation:pulse .8s infinite alternate; background:#22c55e;}
    @keyframes pulse{ from{filter:brightness(1);} to{filter:brightness(1.8);} }

    #netBanner{display:none;text-align:center;background:#fde047;color:#1f2937;padding:8px;font-weight:600;font-size:14px;}

    main{padding:18px;max-width:860px;margin:0 auto;}
    label{display:block;font-size:14px;color:var(--muted);margin-bottom:6px;}
    .row{margin-bottom:14px;}
    input,textarea,select{
      width:100%;box-sizing:border-box;font-size:16px;padding:12px;
      border-radius:12px;border:1px solid #333;
      background:var(--card);color:var(--text);outline:none;
    }
    body[data-theme="light"] input, body[data-theme="light"] textarea {
      border:1px solid #cbd5e1;
    }
    textarea{min-height:100px;resize:vertical;}

    .toolbar{display:flex;gap:8px;margin:10px 0 14px 0;flex-wrap:wrap;align-items:center;}
    .btn,.btn-secondary{
      flex:1;min-width:160px;border:none;border-radius:14px;padding:16px;
      font-size:17px;font-weight:700;cursor:pointer;box-shadow:var(--shadow);
      transition:transform .08s,filter .15s,background .2s;touch-action:manipulation;
    }
    .btn{background:var(--accent);color:#fff;}
    .btn:active{transform:scale(0.98);filter:brightness(0.9);}
    .btn[disabled]{opacity:.6;cursor:not-allowed;}
    .btn-secondary{background:#374151;color:#f9fafb;}
    body[data-theme="light"] .btn-secondary{background:#e0e7ff;color:var(--primary);}
    .btn-secondary:active{transform:scale(0.98);filter:brightness(0.9);}

    .bottom-nav{
      position:fixed;left:0;right:0;bottom:0;z-index:999;
      background:var(--card);border-top:1px solid #333;
      display:flex;gap:8px;padding:10px;box-shadow:0 -2px 6px rgba(0,0,0,0.4);
    }
    .tab-btn{flex:1;border:none;border-radius:10px;padding:12px;font-weight:700;}
    .tab-btn{background:#333;color:#f9fafb;}
    .tab-btn.active{background:var(--accent);color:#fff;}
    body[data-theme="light"] .tab-btn{background:#e0e7ff;color:var(--primary);}
    body[data-theme="light"] .tab-btn.active{background:var(--primary);color:#fff;}

    .pedido-card{background:var(--card);border-radius:12px;padding:14px;margin-bottom:12px;box-shadow:0 2px 8px rgba(0,0,0,0.3);}
    .toast{position:fixed;left:50%;bottom:86px;transform:translateX(-50%);
      background:#ffcd38;color:#1f2937;padding:12px 16px;border-radius:12px;font-size:15px;display:none;z-index:1001;}

    #confirmOverlay{display:none;position:fixed;inset:0;z-index:1002;background:rgba(0,0,0,0.6);align-items:center;justify-content:center;}
    .success-box{background:linear-gradient(180deg,#16a34a,#0ea95e);color:#fff;border-radius:22px;padding:36px 28px;text-align:center;width:min(90vw,420px);box-shadow:0 16px 40px rgba(0,0,0,0.5);animation:popIn .35s ease;}
    .success-icon{font-size:80px;animation:spin 0.7s ease forwards;}
    @keyframes spin{from{transform:rotate(-180deg) scale(.6);opacity:.4;}to{transform:rotate(0) scale(1);opacity:1;}}
    @keyframes popIn{from{transform:scale(0.6);opacity:0;}to{transform:scale(1);opacity:1;}}

    #helloBanner{display:none;margin:-8px 0 10px 0;font-weight:700;color:var(--accent);}
  </style>
</head>
<body>
  <div id="netBanner">üì° Sin conexi√≥n ‚Äî los pedidos se guardan localmente</div>
  <header>
    <button id="themeToggle" title="Cambiar tema">üåô</button>
    <span class="title">üõí Pedidos ML</span>
    <span id="counterBox">0</span>
    <span id="connDot" class="offline"></span>
  </header>

  <main id="nuevoPedido">
    <div id="helloBanner"></div>
    <div class="row"><label>üìÖ Fecha de entrega</label><input type="date" id="fechaEntrega" /></div>
    <div class="row"><label>üßæ N√∫mero de cliente</label><input type="number" id="numeroCliente" placeholder="Ej: 10331" /></div>
    <div class="row"><label>üë§ Nombre del vendedor</label><input type="text" id="nombreVendedor" placeholder="Ej: MARTIN" /></div>
    <div class="row"><label>üì¶ Productos solicitados</label><textarea id="productos" rows="4" placeholder="Detalle de productos..."></textarea></div>
    <div class="row"><label>üóíÔ∏è Observaciones</label><textarea id="observaciones" rows="2" placeholder="Notas adicionales..."></textarea></div>
    <div class="row"><label><input type="checkbox" id="shareWA" /> Enviar resumen por WhatsApp</label></div>
    <div class="toolbar">
      <button id="btnEnviar" class="btn">Enviar pedido</button>
      <button id="btnNuevoLote" class="btn-secondary">Agregar otro</button>
    </div>
  </main>

  <main id="pendientes" style="display:none;"><h3>üìã Pedidos pendientes</h3><div id="listaPendientes"></div></main>
  <main id="estadisticas" style="display:none;"><h3>üìä Estad√≠sticas</h3><div id="stats"></div></main>

  <div class="bottom-nav">
    <button id="btnNuevo" class="tab-btn active">Nuevo</button>
    <button id="btnVerPendientes" class="tab-btn">Pendientes</button>
    <button id="btnVerEstadisticas" class="tab-btn">Estad√≠sticas</button>
  </div>

  <div class="toast" id="toast"></div>
  <div id="confirmOverlay"><div class="success-box"><div class="success-icon">‚úÖ</div><h2>¬°Pedido enviado!</h2></div></div>

<script>
const BACKEND_URL="https://script.google.com/macros/s/AKfycbxPAwRf6K5d7xf-UfcM79wVOE1aMGfn6zT0pp_rF6Ta6qAGoCO8ZIEe2RWLlVP1WRIxEg/exec";
const $=id=>document.getElementById(id);
const btnEnviar=$("btnEnviar"),toast=$("toast"),connDot=$("connDot"),themeToggle=$("themeToggle"),counterBox=$("counterBox");

// === THEME SWITCH ===
(function(){const stored=localStorage.getItem("themeMode")||"dark";setTheme(stored);themeToggle.addEventListener("click",()=>{const newMode=document.body.dataset.theme==="dark"?"light":"dark";setTheme(newMode);});})();
function setTheme(mode){document.body.dataset.theme=mode;localStorage.setItem("themeMode",mode);themeToggle.textContent=mode==="dark"?"‚òÄÔ∏è":"üåô";}

// === COUNTER ===
(function initCounter(){const today=new Date().toISOString().slice(0,10);const saved=JSON.parse(localStorage.getItem("dailyCounter")||"{}");if(saved.date!==today){localStorage.setItem("dailyCounter",JSON.stringify({date:today,count:0}));counterBox.textContent="0";}else counterBox.textContent=saved.count;})();
function incCounter(){const today=new Date().toISOString().slice(0,10);const data=JSON.parse(localStorage.getItem("dailyCounter")||"{}");const count=(data.date===today?(data.count||0):0)+1;localStorage.setItem("dailyCounter",JSON.stringify({date:today,count}));counterBox.textContent=count;counterBox.classList.add("bump");setTimeout(()=>counterBox.classList.remove("bump"),300);}

// === TOAST ===
function showToast(msg,type="info"){toast.textContent=msg;toast.style.background=type==="error"?"#ef4444":type==="ok"?"#86efac":"#ffcd38";toast.style.color=type==="error"?"#fff":"#1f2937";toast.style.display="block";setTimeout(()=>toast.style.display="none",3000);}

// === ENV√çO PEDIDOS ===
async function postPedido(pedido){try{await fetch(BACKEND_URL,{method:"POST",mode:"no-cors",headers:{"Content-Type":"text/plain"},body:JSON.stringify(pedido)});return{status:"ok"};}catch(e){console.error(e);throw e;}}
let sending=false;
async function enviarPedido(){if(sending)return;const fechaEntrega=$("fechaEntrega").value,numeroCliente=$("numeroCliente").value,nombreVendedor=$("nombreVendedor").value,productos=$("productos").value,observaciones=$("observaciones").value;if(!fechaEntrega||!numeroCliente||!nombreVendedor||!productos){showToast("Complet√° todos los campos","error");return;}sending=true;btnEnviar.disabled=true;btnEnviar.textContent="Enviando...";const pedido={id:Date.now(),fechaEntrega,numeroCliente,nombreVendedor,productos,observaciones};try{if(!navigator.onLine)throw new Error("offline");postPedido(pedido);showToast("Pedido enviado","ok");incCounter();$("confirmOverlay").style.display="flex";setTimeout(()=>$("confirmOverlay").style.display="none",1600);}catch(e){showToast("Sin conexi√≥n, guardado local","info");}finally{sending=false;btnEnviar.disabled=false;btnEnviar.textContent="Enviar pedido";}}
btnEnviar.addEventListener("click",enviarPedido);

// === NAV ===
const tabs={nuevo:$("btnNuevo"),pend:$("btnVerPendientes"),stats:$("btnVerEstadisticas")};const sections={nuevo:$("nuevoPedido"),pend:$("pendientes"),stats:$("estadisticas")};
Object.entries(tabs).forEach(([k,btn])=>{btn.onclick=()=>{Object.values(tabs).forEach(b=>b.classList.remove("active"));Object.values(sections).forEach(s=>s.style.display="none");btn.classList.add("active");sections[k].style.display="block";};});

// === ONLINE STATUS ===
function setOnline(on){connDot.className=on?"online":"offline";}
window.addEventListener("online",()=>setOnline(true));
window.addEventListener("offline",()=>setOnline(false));
setOnline(navigator.onLine);
</script>
</body>
</html>
